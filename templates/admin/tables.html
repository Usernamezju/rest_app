{% extends "base.html" %}
{% block title %}ç®¡ç†åå° Â· æ¡Œå°ç®¡ç†{% endblock %}
{% block extra_head %}
<style>
    .admin-nav { background:var(--dark-blue); padding:12px 16px; display:flex; align-items:center; gap:16px; overflow-x:auto; }
    .admin-nav a { color:rgba(255,255,255,0.7); font-size:14px; text-decoration:none; white-space:nowrap; padding:6px 14px; border-radius:8px; transition:all 0.2s; }
    .admin-nav a:hover, .admin-nav a.active { background:rgba(255,255,255,0.12); color:#fff; }
    .admin-nav .brand { font-weight:700; color:#fff; font-size:16px; margin-right:auto; }
    .table-card { display:inline-flex; flex-direction:column; align-items:center; background:#fff; border-radius:14px; padding:20px; margin:6px; min-width:120px; box-shadow:0 2px 12px rgba(0,0,0,0.04); }
    .table-card .num { font-size:24px; font-weight:800; color:var(--dark-blue); }
    .table-card .name { font-size:13px; color:var(--text-grey); margin-top:4px; }
    .table-card .del { font-size:12px; color:var(--alert); cursor:pointer; margin-top:8px; }
</style>
{% endblock %}

{% block body %}
<nav class="admin-nav">
    <span class="brand">ğŸ® å›½åº†é¤é¦†</span>
    <a href="/admin/">ä»ªè¡¨ç›˜</a>
    <a href="/admin/orders">è®¢å•</a>
    <a href="/admin/dishes">èœå“</a>
    <a href="/admin/tables" class="active">æ¡Œå°</a>
    <a href="/admin/reviews">è¯„ä»·</a>
    <a href="/admin/logout" style="color:rgba(255,255,255,0.4);">é€€å‡º</a>
</nav>
<div style="max-width:700px;margin:0 auto;padding:20px 16px;">
    <h2 style="font-size:18px;font-weight:700;margin-bottom:16px;">æ¡Œå°ç®¡ç†</h2>
    <div style="background:#fff;border-radius:14px;padding:20px;box-shadow:0 2px 12px rgba(0,0,0,0.04);margin-bottom:16px;">
        <div style="display:flex;gap:10px;align-items:end;flex-wrap:wrap;">
            <div style="flex:1;">
                <label style="font-size:12px;color:var(--text-grey);display:block;margin-bottom:4px;">æ¡Œå°åç§°</label>
                <input type="text" id="tableName" placeholder="å¦‚ï¼š1å·æ¡Œã€åŒ…é—´A" style="width:100%;padding:8px 12px;border:1.5px solid #e0e0e0;border-radius:8px;font-size:14px;">
            </div>
            <button class="btn-gold" style="height:38px;font-size:13px;" onclick="addTable()">æ·»åŠ </button>
        </div>
    </div>
    <div id="tableGrid" style="display:flex;flex-wrap:wrap;"></div>
    <div style="background:#fffbe6;border-radius:10px;padding:14px;margin-top:20px;font-size:13px;color:#8a6d0b;line-height:1.6;">
        ğŸ’¡ <strong>äºŒç»´ç ç”Ÿæˆæ–¹æ³•ï¼š</strong><br>
        1. æŸ¥æ‰¾æœ¬æœºå±€åŸŸç½‘IPï¼ˆæ‰“å¼€CMDè¾“å…¥ <code>ipconfig</code>ï¼Œæ‰¾åˆ°IPv4åœ°å€ï¼‰<br>
        2. ç”¨åœ¨çº¿äºŒç»´ç ç”Ÿæˆå™¨è¾“å…¥åœ°å€ï¼Œå¦‚ï¼š<code>http://192.168.1.88:5000/?table=1</code><br>
        3. æ‰“å°å¹¶è´´åœ¨å¯¹åº”æ¡Œä¸Š
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
const tables = {{ tables|tojson if tables else '[]' }};

function renderTables() {
    const el = document.getElementById('tableGrid');
    if (!tables.length) { el.innerHTML = '<div style="text-align:center;color:#ccc;padding:20px;width:100%;">æš‚æ— æ¡Œå°</div>'; return; }
    el.innerHTML = tables.map(t => `
        <div class="table-card">
            <div class="num">ğŸª‘</div>
            <div class="name">${t.name}</div>
            <span class="del" onclick="delTable(${t.id})">åˆ é™¤</span>
        </div>
    `).join('');
}

async function addTable() {
    const name = document.getElementById('tableName').value.trim();
    if (!name) return;
    const res = await fetch('/admin/api/tables', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({name}) });
    const t = await res.json();
    tables.push(t);
    document.getElementById('tableName').value = '';
    renderTables();
}

async function delTable(id) {
    if (!confirm('ç¡®å®šåˆ é™¤ï¼Ÿ')) return;
    await fetch(`/admin/api/tables/${id}`, { method:'DELETE' });
    const idx = tables.findIndex(t => t.id === id);
    if (idx >= 0) tables.splice(idx, 1);
    renderTables();
}

renderTables();
</script>
{% endblock %}
